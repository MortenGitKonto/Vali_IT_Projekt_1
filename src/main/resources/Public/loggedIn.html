<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Morten</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
          integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Morten">
    <meta name="generator" content="Jekyll v4.1.1">
    <title>Checkout example · Bootstrap</title>

</head>
<body class="bg-light">
<div class="container">
    <div class="py-5 text-center">
        <img height="72" width="72" alt="" src="img/slider_puffin_jpegmini_mobile.jpg" class="d-block mx-auto mb-4">
        <h2>Morten's bank</h2>
        <p class="lead">Morteni projekt</p>
    </div>
    <div class="col-md-25 order-md-25">
        <h4 class="mb-3">Get your balance</h4>
        <div class="row">
            <div class="col-md-6 mb-3">
                <input type="text" class="form-control" id="inputAccountNrForBalance"
                       placeholder="Enter account nr">
                <input type="text" class="form-control" id="getBalanceNow"
                       placeholder="balance" value="">
                <div class="invalid-feedback">
                    Username is required.
                </div>
            </div>
        </div>
        <br>
        <button id="buttonGetBalance" class="btn btn-primary btn-lg">
            Get your balance
        </button>
        <br>
        <br>
        <br>
        <span id='messagesGetBalance'></span>
        <h4 class="mb-3">Make a deposit</h4>
        <div class="row">
            <div class="col-md-6 mb-3">
                <input type="text" class="form-control" id="inputDepositAccountNr"
                       placeholder="Enter account nr">
                <div class="invalid-feedback">
                    Username is required.
                </div>
                <input type="number" class="form-control" id="inputDepositAmount"
                       placeholder="Enter amount">
                <div class="invalid-feedback">
                    Username is required.
                </div>
            </div>
        </div>
        <button id="buttonMakeDeposit" class="btn btn-primary btn-lg">
            Make a deposit
        </button>
        <br>
        <br>
        <span id='messagesDeposit'></span>
        <h4 class="mb-3">Withdraw money</h4>
        <div class="row">
            <div class="col-md-6 mb-3">
                <input type="text" class="form-control" id="inputWithdrawAccountNr"
                       placeholder="Enter account nr">
                <div class="invalid-feedback">
                    Username is required.
                </div>
                <input type="number" class="form-control" id="inputWithdrawAmount"
                       placeholder="Enter amount">
                <div class="invalid-feedback">
                    Username is required.
                </div>
            </div>
        </div>
        <button id="buttonWithdraw" class="btn btn-primary btn-lg">
            Withdraw
        </button>
        <br>
        <br>
        <span id='messagesWithdraw'></span>
        <div class="invalid-feedback">
            Username is required.
        </div>
        <h4 class="mb-3">Make a transfer</h4>
        <div class="row">
            <div class="col-md-6 mb-3">
                <input type="text" class="form-control" id="inputFromAccountNr"
                       placeholder="Enter sender's account nr">
                <div class="invalid-feedback">
                    Username is required.
                </div>
                <input type="text" class="form-control" id="inputToAccountNr"
                       placeholder="Enter receiver's account nr">
                <input type="number" class="form-control" id="inputFromAmount"
                       placeholder="Enter amount">
                <div class="invalid-feedback">
                    Username is required.
                </div>
            </div>
        </div>
        <button id="buttonTransfer" class="btn btn-primary btn-lg">
            Make a transfer
        </button>
        <br>
        <span id='messagesTransfer'></span>
        <h4 class="mb-3">Get all bank account information</h4>
        <div class="row">
            <div class="col-md-6 mb-3">
                <div class="form-group form-inline">
                    <label for="inputClientIdForAccount">Client ID: </label>
                    <input type="number" class="form-control" id="inputClientIdForAccount"
                           placeholder="Enter client ID" readonly>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 mb-3">
                <button id="buttonOneAccount" class="btn btn-primary btn-lg">
                    Get bank account info
                </button>
                <br>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 mb-3">
                <div class="form-group form-inline">
                    <label for="inputOneAccountNr">Your account nr:</label>
                    <input type="text" class="form-control" id="inputOneAccountNr"
                           placeholder="account nr" value="">
                </div>
                <div class="form-group form-inline">
                    <label for="inputOneAccountBalance">Your balance is:</label>
                    <input type="text" class="form-control" id="inputOneAccountBalance"
                           placeholder="balance" value="">
                </div>
                <div class="form-group form-inline">
                    <label for="inputOneAccountId">Your bank account ID is:</label>
                    <input type="text" class="form-control" id="inputOneAccountId"
                           placeholder="account ID" value="">
                </div>
            </div>
            <div class="invalid-feedback">
                Username is required.
            </div>
        </div>
    </div>
    <br>
    <br>
    <br>
    <br>
    <span id='messagesOneAccount'></span>
    <span id='messagesGetClientId'></span>
    <br>
    <br>
    <div class="col-md-6 mb-3">
        <button id="buttonAllAccounts">
            Get info about all accounts
        </button>
        <br>
        <span id='messagesAccounts'></span>
        <br>
        <br>
        <button id="buttonAllClients">
            Get info about all clients
        </button>
        <br>
        <span id='messagesClients'></span>
        <br>
        <br>
    </div>
</div>

<script>

    let inputAccountNrForBalance = document.getElementById("inputAccountNrForBalance");
    let buttonGetBalance = document.getElementById("buttonGetBalance");
    let messagesGetBalance = document.getElementById('messagesGetBalance');

    let balanceValue = "";

    //Get account balance
    function showBalance(balanceValue) {
        document.getElementById("getBalanceNow").value = balanceValue;
    }

    //Auto-fill account nr everywhere
    function fillAllAccNrInput(inputAccountNrForBalance) {
        document.getElementById("inputDepositAccountNr").value = inputAccountNrForBalance.value;
        document.getElementById("inputWithdrawAccountNr").value = inputAccountNrForBalance.value;
        document.getElementById("inputFromAccountNr").value = inputAccountNrForBalance.value;
    }

    //Get bank account balance
    buttonGetBalance.addEventListener('click', function () {
        fetch('/sqltestBalance/' + inputAccountNrForBalance.value, {
            method: 'GET',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(function (response) {
                return response.json();
                <!--                console.log(response);-->
            })
            .then(function (jsonData) {
                messagesGetBalance.innertext = JSON.stringify(jsonData);

                balanceValue = messagesGetBalance.innertext;
                showBalance(balanceValue);

                fillAllAccNrInput(inputAccountNrForBalance);
                // console.log(messagesGetBalance.innertext);
            })
            .catch(function (err) {
                <!--                console.log(err);-->
                messagesGetBalance = 'This does not seem right';
                <!--                console.log(messagesGetBalance.innerText);-->
            });
    })


    let buttonAllAccounts = document.getElementById("buttonAllAccounts");
    let messagesAccounts = document.getElementById('messagesAccounts');

    //Get info of all bank accounts
    buttonAllAccounts.addEventListener('click', function () {
        fetch('/sqltestAllAccounts', {
            method: 'GET',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(function (response) {
                return response.json();
                //console.log(response);
            })
            .then(function (jsonData) {
                messagesAccounts.innerText = JSON.stringify(jsonData);
                console.log(jsonData);
                ;
            })
            .catch(function (err) {
                messagesAccounts.innerText = 'This does not seem right';
                console.log(messagesAccounts.innerText);
            });
    })


    let buttonAllClients = document.getElementById("buttonAllClients");
    let messagesClients = document.getElementById('messagesClients');

    //Get info of all clients
    buttonAllClients.addEventListener('click', function () {
        fetch('/sqltestAllClients', {
            method: 'GET',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(function (response) {
                return response.json();
                console.log(response.json());
            })
            .then(function (jsonData) {
                messagesClients.innerText = JSON.stringify(jsonData);
                console.log(messagesClients.innerText);
                ;
            })
            .catch(function (err) {
                messagesClients.innerText = 'This does not seem right';
                console.log(messagesClients.innerText);
            });
    })

    //Get information as Strings to use them however necessary
    function getSubstrings(substringJson) {

        //Kogu json
        let json = substringJson;
        console.log(json);

        //ACCNR
        //AccNr lõpu-quote
        let accFin = json.indexOf('"', 19);
        console.log(accFin);
        //Account nr substring
        let accNrSubstring = json.substring(19, accFin);
        console.log(accNrSubstring);
        //messagesOneAccountNr.innerText=accNrSubstring;
        document.getElementById("inputOneAccountNr").value = accNrSubstring;


        //AMOUNT
        //Amount lõpu-quote
        let amountFin = json.indexOf('"', accFin + 3);
        console.log(amountFin);
        //id algus-quote
        let idBegin = json.indexOf('"', amountFin + 1);
        console.log(idBegin);
        //amount substring
        let amountSubstring = json.substring((amountFin + 2), (idBegin - 1));
        console.log(amountSubstring);
        //messagesOneAccountBalance.innerText=amountSubstring;
        document.getElementById("inputOneAccountBalance").value = amountSubstring;

        //ID
        //id lõpu-quote
        let idFin = json.indexOf('"', idBegin + 1);
        console.log(idFin);
        //clientId algus-quote
        let clientIdBegin = json.indexOf('"', idFin + 1);
        console.log(clientIdBegin);
        //id substring
        let idSubstring = json.substring((idFin + 2), (clientIdBegin - 1));
        console.log(idSubstring);
        //messagesOneAccountId.innerText=idSubstring;
        document.getElementById("inputOneAccountId").value = idSubstring;

        // Client ID
        // clientId lõpu-quote
        // let clientIdFin = json.indexOf('"', clientIdBegin + 1);
        // console.log(clientIdFin);
        // lõpu braces
        // let endBraces = json.indexOf('}', clientIdFin + 1);
        // console.log(endBraces);
        // clientId substring
        // let clientIdSubstring = json.substring((clientIdFin + 2), endBraces);
        // console.log(clientIdSubstring);
        // messagesOneAccountClientId.innerText=clientIdSubstring;
        // document.getElementById("inputOneAccountClientId").value = clientIdSubstring;
    }

    let inputIdForAcc = document.getElementById("inputClientIdForAccount");
    let buttonOneAccount = document.getElementById("buttonOneAccount");

    let messagesOneAccount = document.getElementById('messagesOneAccount');
    let inputOneAccountNr = document.getElementById('inputOneAccountNr');
    let inputOneAccountBalance = document.getElementById('inputOneAccountBalance');
    let inputOneAccountId = document.getElementById('inputOneAccountId');
    let inputOneAccountClientId = document.getElementById('inputOneAccountClientId');

    //Get all info of one account
    buttonOneAccount.addEventListener('click', function () {
        fetch('/testOneAccount/' + inputIdForAcc.value, {
            method: 'GET',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(function (response) {
                return response.json();
                <!--                console.log(response);-->
            })
            .then(function (jsonData) {
                messagesOneAccount.innerText = JSON.stringify(jsonData);
                getSubstrings(messagesOneAccount.innerText);
                console.log(messagesOneAccount.innerText);
            })
            .catch(function (err) {
                <!--                console.log(err);-->
                messagesOneAccount.innerText = 'This does not seem right';
                <!--                console.log(messagesOneAccount.innerText);-->
            });
    })

    //let inputId = document.getElementById("inputClientIdForCreateAccount");

    //BUTTON
    //let buttonGetId = document.getElementById("buttonGetId");

    //MESSAGE
    let messagesGetClientId = document.getElementById('messagesGetClientId');

    let idVal = "";

    function showId(idVal) {
        inputIdForAcc.value = idVal;
    }

    //Auto-fill ID
    document.addEventListener('DOMContentLoaded', function () {
        fetch('/sqltestId', {
            method: 'GET',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(function (response) {
                return response.json();
                <!--                console.log(response);-->
            })
            .then(function (jsonData) {

                idVal = JSON.stringify(jsonData);
                showId(idVal);
// console.log(messagesGetBalance.innertext);
            })
            .catch(function (err) {
                <!--                console.log(err);-->
                messagesGetId = 'This does not seem right';
                <!--                console.log(messagesGetBalance.innerText);-->
            });
    })


    //INPUT
    let inputDepositAmount = document.getElementById("inputDepositAmount");
    let inputDepositAccountNr = document.getElementById("inputDepositAccountNr");

    //BUTTON
    let buttonMakeDeposit = document.getElementById("buttonMakeDeposit");

    //MESSAGE
    let messagesDeposit = document.getElementById('messagesDeposit');

    //Deposit money
    buttonMakeDeposit.addEventListener('click', function () {
        fetch('/sqlDepositIntoAccount', {
            method: 'PUT',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                accountNumber: inputDepositAccountNr.value,
                amount: inputDepositAmount.value
            })
        })
            .then(function () {
                messagesDeposit.innerText = 'Success';
            })
            .catch(function (err) {
                console.log(err);
                messagesDeposit.innerText = 'This does not seem right';
            });
    })


    //INPUT
    let inputWithdrawAmount = document.getElementById("inputWithdrawAmount");
    let inputWithdrawAccountNr = document.getElementById("inputWithdrawAccountNr");

    //BUTTON
    let buttonWithdraw = document.getElementById("buttonWithdraw");

    //MESSAGE
    let messagesWithdraw = document.getElementById('messagesWithdraw');

    //Withdraw money
    buttonWithdraw.addEventListener('click', function () {
        fetch('/sqlWithdrawFromAccount', {
            method: 'PUT',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                accountNumber: inputWithdrawAccountNr.value,
                amount: inputWithdrawAmount.value
            })
        })
            .then(function () {
                messagesWithdraw.innerText = 'Success';
            })
            .catch(function (err) {
                console.log(err);
                messagesWithdraw.innerText = 'This does not seem right';
            });
    })


    //INPUT
    let inputFromAccountNr = document.getElementById("inputFromAccountNr");
    let inputFromAmount = document.getElementById("inputFromAmount");
    let inputToAccountNr = document.getElementById("inputToAccountNr");


    //BUTTON
    let buttonTransfer = document.getElementById("buttonTransfer");

    //MESSAGE
    let messagesTransfer = document.getElementById('messagesTransfer');

    //Transfer money from account into another
    buttonTransfer.addEventListener('click', function () {
        fetch('/sqlTransferFromAccountToAccount', {
            method: 'PUT',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(
                [{
                    accountNumber: inputFromAccountNr.value,
                    amount: inputFromAmount.value
                }, {
                    accountNumber: inputToAccountNr.value
                }]
            )
        })
            .then(function () {
                messagesTransfer.innerText = 'Success';
            })
            .catch(function (err) {
                console.log(err);
                messagesTransfer.innerText = 'This does not seem right';
            });
    })
</script>
<footer class="my-5 pt-5 text-muted text-center text-small">
    <p class="mb-1">© 2020 Morten's bank</p>
</footer>
</div>
</body>
</html>